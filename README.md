# Baseball RAG Agent

A locally-hosted AI assistant that answers complex baseball questions using real data from FanGraphs and advanced retrieval techniques.

**Status:** MVP Complete - Real-time Streaming Chat Interface  
**Next Phase:** Enhanced Retrieval (Full-Text Search + Reranking)

## What It Does

Ask complex baseball questions and get accurate, data-backed answers:

- **Player Comparisons**: "Compare Mike Trout and Ken Griffey Jr's careers"
- **Historical Analysis**: "Who were the best power hitters in the steroid era?"
- **Similar Players**: "Show me players similar to Vladimir Guerrero Jr's offensive profile"
- **Career Insights**: "What are Mookie Betts' biggest strengths and weaknesses?"

The system retrieves real statistics from a PostgreSQL database, uses semantic search to find relevant players, and generates responses with an LLM that can cite specific data sources.

## Quick Start

### Prerequisites
- Docker & Docker Compose
- Ollama (for local LLM)
- R (for data pipeline)

### 1. Start Ollama
```bash
ollama serve
ollama pull llama3.2
```

### 2. Start the Application
```bash
# Production mode
./start.sh

# Development mode (with hot reload)
./start.sh dev
```

### 3. Populate Data
```bash
# Run ETL to load FanGraphs data
cd fangraphs && Rscript batter_leaderboard_etl.r

# Generate embeddings for semantic search
cd embeddings && npm install && npm run build && npm run generate
```

### 4. Access the App
- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:3001
- **Database**: localhost:5432 (postgres/baseball123)

## Features

### ‚úÖ Current Capabilities
- **Real-time streaming responses** - See answers appear as the AI generates them
- **Semantic search** - Find players by playing style, not just names
- **Statistical analysis** - Access to 35+ years of FanGraphs batting data (1988-2025)
- **Tool-based retrieval** - LLM uses specific functions to query the database
- **Grade-based filtering** - 20-80 scouting scale grades for power, contact, speed, etc.
- **Career aggregations** - Multi-season summaries and comparisons

### üéØ Next Phase: Enhanced Retrieval
- **Full-text search** for keyword queries ("all time great shortstops")
- **Cross-encoder reranking** for better precision on complex queries
- **Two-stage retrieval** pipeline (fast recall + precise ranking)

### üìã Future Features
- **Percentile rankings** with visual profiles
- **Statcast integration** (exit velocity, launch angle, etc.)
- **Pitcher data** and analysis
- **Interactive visualizations** generated by R

## Architecture

```
Data Sources (FanGraphs) ‚Üí R ETL ‚Üí PostgreSQL + PGVector ‚Üí TypeScript Backend ‚Üí React Frontend
                                        ‚Üì
                                   Ollama LLM ‚Üê Semantic Search + Tool Calling
```

**Key Technologies:**
- **Data**: R + baseballr package for FanGraphs API
- **Database**: PostgreSQL 16 + pgvector for embeddings
- **Backend**: TypeScript/Node.js + Fastify + Ollama integration
- **Frontend**: React + TypeScript + Material UI
- **AI**: Local LLM (llama3.2) + transformers.js embeddings

## Current Limitations

- **Batter data only** - No pitcher statistics yet
- **FanGraphs only** - Missing Baseball Reference biographical data
- **Basic search** - Single-stage semantic search (reranking coming in Phase 2)
- **Template summaries** - Player descriptions use fixed templates
- **Known issues** with some tool parameters and grade filtering

## Performance

- **Query time**: ~1-3 seconds for complex questions
- **Database**: 35+ years of batting data (~50K player-seasons)
- **Embeddings**: 768-dimensional vectors using all-mpnet-base-v2
- **Local-first**: No cloud dependencies, runs entirely on localhost

## Development

See [PROJECT_PLAN.md](PROJECT_PLAN.md) for detailed technical specifications, architecture decisions, and development roadmap.

### Project Structure
```
‚îú‚îÄ‚îÄ fangraphs/          # R ETL scripts
‚îú‚îÄ‚îÄ backend/            # TypeScript API server
‚îú‚îÄ‚îÄ frontend/           # React chat interface
‚îú‚îÄ‚îÄ embeddings/         # Embedding generation
‚îú‚îÄ‚îÄ docker/             # Docker configuration
‚îî‚îÄ‚îÄ docs/               # Additional documentation
```

### Key Commands
```bash
# Start all services
./start.sh [dev]

# Run ETL pipeline
cd fangraphs && Rscript batter_leaderboard_etl.r

# Generate embeddings
cd embeddings && npm run generate

# Backend development
cd backend && npm run dev

# Frontend development
cd frontend && npm run dev
```

## Contributing

This is a personal project exploring RAG techniques for baseball analytics. The codebase prioritizes:

1. **Accuracy over speed** - Real data, not LLM hallucinations
2. **Local-first** - No cloud dependencies
3. **Incremental development** - Ship working features, iterate later

See [PROJECT_PLAN.md](PROJECT_PLAN.md) for the full development roadmap and technical details.